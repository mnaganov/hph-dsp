declare name "Crossfeed Effect";
declare author "Mikhail Naganov";
declare version "1.0";

import("filter.lib");

d_bcoeffs = (1.3922589117, -0.1671886707, -0.3900848919, -0.2609142131, -0.3148044725, -0.2134394791, -0.1957839015, -0.0807061748, -0.0887963165, -0.0180883859, 0.0350882442, 0.0637338379, -0.0201605796, -0.0090717694, 0.0231320277, 0.0921629468, 0.0560207339, 0.0618578353, -0.0497107379, 0.0470489467, 0.0256121565, 0.1323512997, -0.0020002313, -0.0883802218, -0.0129688278);
d_acoeffs = (-0.1129403942, -0.2727873359, -0.1827000490, -0.2229877300, -0.1521366090, -0.1407647106, -0.0592798300, -0.0655907149, -0.0152774659, 0.0228200172, 0.0436231436, -0.0162197293, -0.0082752179, 0.0148246054, 0.0645635654, 0.0391380484, 0.0437206249, -0.0360483241, 0.0332509090, 0.0180501678, 0.0949150900, -0.0008989325, -0.0628379705, -0.0091819141);
o_bcoeffs = (0.9141694726, -0.1127635557, -0.0881471039, -0.0939509156, -0.0883839602, -0.0882451526, -0.0826659823, -0.0801528041, -0.0764742448, -0.0720208571, -0.0637180011, -0.0589303959, -0.0535325674, -0.0446329674, -0.0357088157, -0.0292512277, -0.0185360888, -0.0073673874, 0.0010375189, 0.0159059830, 0.0231105552, 0.0413518324, 0.0459948502, 0.0786203629, 0.0166152739);
o_acoeffs = (-0.1337734910, -0.1026681154, -0.1085870213, -0.1008947578, -0.0998820140, -0.0925990543, -0.0890478344, -0.0841071847, -0.0785473366, -0.0687504424, -0.0630119486, -0.0565990941, -0.0465052360, -0.0364403365, -0.0292228985, -0.0173716205, -0.0051774368, 0.0039183684, 0.0199906621, 0.0275570833, 0.0471440559, 0.0516994849, 0.0868659694, 0.0181916700);
pre_attn = 0.5559042573;
opp_attn = 0.4206297637;

channel_process(x, y) = (x : iir(d_bcoeffs, d_acoeffs)) + ((y : iir(o_bcoeffs, o_acoeffs)) * opp_attn);
crossfeed(x, y) = channel_process(x, y), channel_process(y, x);
process = *(pre_attn), *(pre_attn) : crossfeed;
